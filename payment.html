<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Reserve and Park</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="firebase-config.js"></script>
</head>
<body class="min-h-screen bg-gray-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8">
        <div class="text-center mb-6">
            <div class="inline-block p-3 bg-blue-100 rounded-full mb-4">
                <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-800">Complete Payment</h2>
        </div>

        <!-- Parking Details -->
        <div id="spotDetails" class="bg-gray-50 rounded-lg p-4 mb-6">
            <h3 id="spotName" class="font-semibold text-gray-800 mb-2"></h3>
            <p id="spotAddress" class="text-sm text-gray-600 mb-3"></p>
            <div class="flex justify-between items-center">
                <span class="text-gray-600">Amount to Pay:</span>
                <span id="amountDisplay" class="text-2xl font-bold text-blue-600"></span>
            </div>
        </div>

        <!-- Payment Form -->
        <form id="paymentForm" class="space-y-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Card Number</label>
                <input
                    type="text"
                    id="cardNumber"
                    placeholder="1234 5678 9012 3456"
                    maxlength="19"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Expiry Date</label>
                    <input
                        type="text"
                        id="expiryDate"
                        placeholder="MM/YY"
                        maxlength="5"
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">CVV</label>
                    <input
                        type="text"
                        id="cvv"
                        placeholder="123"
                        maxlength="3"
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Cardholder Name</label>
                <input
                    type="text"
                    id="cardholderName"
                    placeholder="John Doe"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
            </div>

            <button
                type="submit"
                id="payButton"
                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200"
            >
                Pay Now
            </button>
        </form>

        <button
            id="cancelBtn"
            class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-200 mb-4"
        >
            Cancel
        </button>

        <p class="text-xs text-gray-500 text-center">
            ðŸ”’ Secured by Razorpay (Demo Mode)
        </p>
    </div>

    <script>
        // Check if user is logged in
        const user = JSON.parse(localStorage.getItem('parkingUser'));
        if (!user) {
            window.location.href = 'login.html';
        }

        // Get selected parking spot
        const selectedSpot = JSON.parse(localStorage.getItem('selectedParkingSpot'));
        if (!selectedSpot) {
            window.location.href = 'dashboard.html';
        }

        // Display spot details
        document.getElementById('spotName').textContent = selectedSpot.name;
        document.getElementById('spotAddress').textContent = selectedSpot.address;
        document.getElementById('amountDisplay').textContent = 'â‚¹' + selectedSpot.price;
        document.getElementById('payButton').textContent = 'Pay â‚¹' + selectedSpot.price;

        // Format card number input
        document.getElementById('cardNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });

        // Format expiry date input
        document.getElementById('expiryDate').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }
            e.target.value = value;
        });

        // Format CVV input (numbers only)
        document.getElementById('cvv').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        });

        // Handle payment form submission
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Simulate payment processing
            const payButton = document.getElementById('payButton');
            payButton.disabled = true;
            payButton.textContent = 'Processing...';
            payButton.classList.add('opacity-50');

            setTimeout(function() {
                // Create booking
                const booking = {
                    id: Date.now(),
                    spotName: selectedSpot.name,
                    spotAddress: selectedSpot.address,
                    date: new Date().toLocaleString(),
                    transactionId: 'TXN' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                    amount: selectedSpot.price
                };

                // Save booking
                const bookings = JSON.parse(localStorage.getItem('parkingBookings') || '[]');
                bookings.push(booking);
                localStorage.setItem('parkingBookings', JSON.stringify(bookings));

                // Store receipt for display
                localStorage.setItem('latestReceipt', JSON.stringify(booking));

                // Clear selected spot
                localStorage.removeItem('selectedParkingSpot');

                // Redirect to receipt page
                window.location.href = 'receipt.html';
            }, 2000);
        });

        // Cancel button
        document.getElementById('cancelBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to cancel this payment?')) {
                localStorage.removeItem('selectedParkingSpot');
                window.location.href = 'parking-spots.html';
            }
             
        });
    </script>
    <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<!-- Your Firebase Config -->
<script src="firebase-config.js"></script>
</body>
</html>